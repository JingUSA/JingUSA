"0","#install.packages(""quarto"")"
"0",""
"0","# Charts #1–#4  |  Alternative robust version (no tidytext)"
"0",""
"0","suppressPackageStartupMessages({"
"0","  library(readr); library(dplyr); library(tidyr)"
"0","  library(ggplot2); library(scales); library(lubridate)"
"0","  library(stringr); library(forcats)"
"0","})"
"0","options(scipen = 999)"
"0",""
"0","# ---------- 0) Load & clean ----------"
"0","csv_path <- ""/Users/jingtao/Desktop/FALL 2025/DATA VISUALIZATION/Jing Tao/owid-covid-data.csv""   "
"0","owid <- read_csv(csv_path, show_col_types = FALSE)"
"0"," "
"0","need <- c(""continent"",""location"",""date"",""population"",""total_cases"",""gdp_per_capita"")"
"0","stopifnot(all(need %in% names(owid)))"
"0",""
"0","latest <- owid %>%"
"0","  select(all_of(need)) %>%"
"0","  filter(!is.na(continent), !is.na(population), population > 0) %>%"
"0","  mutate(date_clean = ymd(str_sub(as.character(date), 1, 10), quiet = TRUE)) %>%"
"0","  filter(!is.na(date_clean)) %>%"
"0","  group_by(location) %>%"
"0","  slice_max(order_by = date_clean, n = 1, with_ties = FALSE) %>%"
"0","  ungroup()"
"0",""
"0","df <- latest %>%"
"0","  transmute("
"0","    Continent  = continent,"
"0","    Country    = location,"
"0","    Population = as.numeric(population) / 1e6,   # 百万人"
"0","    Cases      = as.numeric(total_cases),"
"0","    GDP        = as.numeric(gdp_per_capita)"
"0","  )"
"0",""
"0","if (!dir.exists(""outputs"")) dir.create(""outputs"", recursive = TRUE)"
"0","stamp <- format(Sys.time(), ""%Y%m%d_%H%M%S"")"
"0","save_png <- function(p, name, w=12, h=7, dpi=300){"
"0","  fn <- file.path(""outputs"", paste0(name, ""_"", stamp, "".png""))"
"0","  ggsave(fn, p, width=w, height=h, dpi=dpi); message(""Saved: "", fn)"
"0","}"
"0",""
"0","# Chart 1 — Variable Width Column"
"0","wrap_cont <- function(x) gsub("" "", ""\n"", x)"
"0",""
"0","mekko <- df %>%"
"0","  group_by(Continent) %>%"
"0","  summarise("
"0","    pop_sum = sum(Population, na.rm = TRUE),"
"0","    cases_median = median(Cases, na.rm = TRUE),"
"0","    .groups = ""drop"""
"0","  ) %>%"
"0","  arrange(Continent) %>%"
"0","  mutate("
"0","    width_share = pop_sum / sum(pop_sum),"
"0","    xmin = lag(cumsum(width_share), default = 0),"
"0","    xmax = cumsum(width_share),"
"0","    xmid = (xmin + xmax) / 2,"
"0","    Cont_lbl = wrap_cont(Continent)"
"0","  )"
"0",""
"0","p1 <- ggplot(mekko) +"
"0","  geom_rect(aes(xmin=xmin, xmax=xmax, ymin=0, ymax=cases_median, fill=Continent),"
"0","            color=""white"") +"
"0","  scale_x_continuous(breaks=mekko$xmid, labels=mekko$Cont_lbl, expand=c(0.02,0)) +"
"0","  scale_y_continuous(labels=label_comma()) +"
"0","  labs("
"0","    title=""Chart 1 — Variable Width Column Chart"","
"0","    subtitle=""Width = population share (millions); Height = median total cases (latest per country)"","
"0","    x=""Continent (bar width ∝ population share)"", y=""Median Total Cases"""
"0","  ) +"
"0","  theme_minimal(base_size=13) +"
"0","  theme(legend.position=""none"", plot.title=element_text(face=""bold""))"
"0","print(p1)"
